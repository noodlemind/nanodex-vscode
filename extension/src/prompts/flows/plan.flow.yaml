id: nanodex.flow.plan
sourceFile: "commands/plan.md"
intent: "Transform feature descriptions into well-structured GitHub issues"
inputs:
  - name: goal
    required: true

context:
  inject:
    - name: relevant_nodes
      query: "relevant_nodes(goal='{goal}', max=12)"

steps:
  - name: "Repository Research & Context Gathering"
    agentId: "nanodex.specialist.repo-research-analyst"
    prompt: |
      First, I need to understand the project's conventions and existing patterns, leveraging all available resources and use parallel subagents to do this.

      Run these three agents in parallel at the same time:

      - Task repo-research-analyst(feature_description)
      - Task best-practices-researcher (feature_description)
      - Task framework-docs-researcher (feature_description)

      **Reference Collection:**

      - [ ] Document all research findings with specific file paths (e.g., `app/services/example_service.rb:42`)
      - [ ] Include URLs to external documentation and best practices guides
      - [ ] Create a reference list of similar issues or PRs (e.g., `#123`, `#456`)
      - [ ] Note any team conventions discovered in `CLAUDE.md` or team documentation

  - name: "Issue Planning & Structure"
    agentId: "nanodex.specialist.repo-research-analyst"
    prompt: |
      Think like a product manager - what would make this issue clear and actionable? Consider multiple perspectives

      **Title & Categorization:**

      - [ ] Draft clear, searchable issue title using conventional format (e.g., `feat:`, `fix:`, `docs:`)
      - [ ] Identify appropriate labels from repository's label set (`gh label list`)
      - [ ] Determine issue type: enhancement, bug, refactor

      **Stakeholder Analysis:**

      - [ ] Identify who will be affected by this issue (end users, developers, operations)
      - [ ] Consider implementation complexity and required expertise

      **Content Planning:**

      - [ ] Choose appropriate detail level based on issue complexity and audience
      - [ ] List all necessary sections for the chosen template
      - [ ] Gather supporting materials (error logs, screenshots, design mockups)
      - [ ] Prepare code examples or reproduction steps if applicable, name the mock filenames in the lists

  - name: "Choose Implementation Detail Level"
    agentId: "nanodex.specialist.best-practices-researcher"
    prompt: |
      Select how comprehensive you want the issue to be:

      #### üìÑ MINIMAL (Quick Issue)

      **Best for:** Simple bugs, small improvements, clear features

      **Includes:**

      - Problem statement or feature description
      - Basic acceptance criteria
      - Essential context only

      #### üìã MORE (Standard Issue)

      **Best for:** Most features, complex bugs, team collaboration

      **Includes everything from MINIMAL plus:**

      - Detailed background and motivation
      - Technical considerations
      - Success metrics
      - Dependencies and risks
      - Basic implementation suggestions

      #### üìö A LOT (Comprehensive Issue)

      **Best for:** Major features, architectural changes, complex integrations

      **Includes everything from MORE plus:**

      - Detailed implementation plan with phases
      - Alternative approaches considered
      - Extensive technical specifications
      - Resource requirements and timeline
      - Future considerations and extensibility
      - Risk mitigation strategies
      - Documentation requirements

  - name: "Issue Creation & Formatting"
    agentId: "nanodex.specialist.best-practices-researcher"
    prompt: |
      Apply best practices for clarity and actionability, making the issue easy to scan and understand

      **Content Formatting:**

      - [ ] Use clear, descriptive headings with proper hierarchy (##, ###)
      - [ ] Include code examples in triple backticks with language syntax highlighting
      - [ ] Add screenshots/mockups if UI-related (drag & drop or use image hosting)
      - [ ] Use task lists (- [ ]) for trackable items that can be checked off
      - [ ] Add collapsible sections for lengthy logs or optional details using `<details>` tags
      - [ ] Apply appropriate emoji for visual scanning (üêõ bug, ‚ú® feature, üìö docs, ‚ôªÔ∏è refactor)

      **Cross-Referencing:**

      - [ ] Link to related issues/PRs using #number format
      - [ ] Reference specific commits with SHA hashes when relevant
      - [ ] Link to code using GitHub's permalink feature (press 'y' for permanent link)
      - [ ] Mention relevant team members with @username if needed
      - [ ] Add links to external resources with descriptive text

      **AI-Era Considerations:**

      - [ ] Account for accelerated development with AI pair programming
      - [ ] Include prompts or instructions that worked well during research
      - [ ] Note which AI tools were used for initial exploration (Claude, Copilot, etc.)
      - [ ] Emphasize comprehensive testing given rapid implementation
      - [ ] Document any AI-generated code that needs human review

      **Pre-submission Checklist:**

      - [ ] Title is searchable and descriptive
      - [ ] Labels accurately categorize the issue
      - [ ] All template sections are complete
      - [ ] Links and references are working
      - [ ] Acceptance criteria are measurable
      - [ ] Add names of files in pseudo code examples and todo lists
      - [ ] Add an ERD mermaid diagram if applicable for new model changes
